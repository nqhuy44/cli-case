tools:
  - name: git
    category: Dev
    preqs:
    cmd_check: |
      if git --version > /dev/null 2>&1; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        brew install git
    cmd_uninstall:
      default: |
        brew uninstall git

  - name: nvm
    category: Dev
    preqs:
    cmd_check: |
      if [[ "$SHELL" == *"zsh"* ]]; then
        if zsh -c 'source ~/.zshrc && nvm --version' > /dev/null 2>&1; then
          echo 1
        else
          echo 0
        fi
      else
        if nvm --version > /dev/null 2>&1; then
          echo 1
        else
          echo 0
        fi
      fi
    cmd_install:
      default: |
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
        # Add NVM_DIR to zsh profile if not already present
        if ! grep -q "NVM_DIR" ~/.zshrc; then
          echo 'export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"' >> ~/.zshrc
          echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm' >> ~/.zshrc
        fi
    cmd_uninstall: 
      default: |
        nvm_dir="${NVM_DIR:-~/.nvm}"
        nvm unload
        rm -rf "$nvm_dir"
        # Remove NVM_DIR from zsh profile
        sed -i '' '/NVM_DIR/d' ~/.zshrc

  - name: ohmyzsh
    category: shell
    preqs:
    cmd_check: |
      if [ -d ~/.oh-my-zsh ]; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
    cmd_uninstall:
      default: |
        rm -rf ~/.oh-my-zsh

  - name: zsh-autosuggestions
    category: shell
    preqs:
    cmd_check: |
      if [ -d ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions ] || brew list --formula | grep -q zsh-autosuggestions; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        brew install zsh-autosuggestions --ignore-dependencies
        # check and activate zsh-autosuggestions
        if ! grep -q "zsh-autosuggestions" ~/.zshrc; then
          echo 'source /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh' >> ~/.zshrc
        fi
    cmd_uninstall:
      default: |
        brew uninstall zsh-autosuggestions

  - name: just
    category: Dev
    preqs:
    cmd_check: |
      if just --version > /dev/null 2>&1; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        brew install just --ignore-dependencies
    cmd_uninstall:
      default: |
        brew uninstall just

  # - name: jq
  #   category: shell
  #   preqs:
  #   cmd_check: |
  #     if jq --version > /dev/null 2>&1; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install jq
  #   cmd_uninstall: |
  #     brew uninstall jq

  # - name: fzf
  #   category: shell
  #   preqs:
  #   cmd_check: |
  #     if [ -d ~/.fzf ] || brew list --formula | grep -q fzf; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install fzf
  #   cmd_uninstall: |
  #     brew uninstall fzf

  # - name: azure-cli
  #   category: DevOps
  #   preqs:
  #   cmd_check: |
  #     if az --version > /dev/null 2>&1; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install azure-cli
  #   cmd_uninstall: |
  #     brew uninstall azure-cli

  # - name: kubectl
  #   category: Kubernetes
  #   preqs:
  #   cmd_check: |
  #     if kubectl version --client > /dev/null 2>&1; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install kubectl
  #   cmd_uninstall: |
  #     brew uninstall kubectl

  # - name: kubectx
  #   category: Kubernetes
  #   preqs:
  #     - kubectl
  #   cmd_check: |
  #     if [ -d ~/.kubectx ] || brew list --formula | grep -q kubectx; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install kubectx
  #   cmd_uninstall: |
  #     brew uninstall kubectx

  # - name: helm
  #   category: Kubernetes
  #   preqs:
  #   cmd_check: |
  #     if helm version > /dev/null 2>&1; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install helm
  #   cmd_uninstall: |
  #     brew uninstall helm

  # - name: helmfile
  #   category: Kubernetes
  #   preqs:
  #     - helm
  #     - helm-diff
  #   cmd_check: |
  #     if helmfile --version > /dev/null 2>&1; then
  #       echo 1
  #     else
  #       echo 0
  #     fi
  #   cmd_install: |
  #     brew install helmfile
  #   cmd_uninstall: |
  #     brew uninstall helmfile

  # - name: helm-diff
  #   category: Kubernetes
  #   preqs:
  #     - helm
  #   cmd_check: |
  #     if helm plugin list | grep -q "^diff"; then
  #         echo 1
  #     else
  #         echo 0
  #     fi
  #   cmd_install: |
  #     helm plugin install https://github.com/databus23/helm-diff
  #   cmd_uninstall: |
  #     helm plugin uninstall diff
  - name: wget
    category: ultis
    preqs:
    cmd_check: |
      if wget --version > /dev/null 2>&1; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        brew install wget
    cmd_uninstall:
      default: |
        brew uninstall wget

  - name: aws-cli
    category: DevOps
    preqs:
    cmd_check: |
      if aws --version > /dev/null 2>&1; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
        installer -pkg ./AWSCLIV2.pkg -target /

  - name: opentofu
    category: DevOps
    preqs:
    cmd_check: |
      # Check if opentofu is installed by using opentofu --version
      if opentofu --version > /dev/null 2>&1; then
        echo 1
      else
        echo 0
      fi
    cmd_install:
      default: |
        brew install tofu
      version: |-
        error_handler() {
          echo "Error occurred in script at line: $1"
            exit 1
        }

        # Trap errors and call error_handler
        trap 'error_handler $LINENO' ERR

        OS=$(uname -s | tr '[:upper:]' '[:lower:]')_$(uname -m | tr '[:upper:]' '[:lower:]')
        PACKAGE="tofu_${VERSION}_${OS}.tar.gz"
        PACKAGE_DIR="tofu_${VERSION}_${OS}"
        URL="https://github.com/opentofu/opentofu/releases/download/v$VERSION/$PACKAGE"
        echo $URL
        curl -LO $URL

        if [ $? -ne 0 ]; then
          echo "Failed to download tofu"
          exit 1
        fi
        
        # untar the package keep directory structure
        echo "-- Extracting package"
        mkdir -p ./$PACKAGE_DIR
        tar -xzf $PACKAGE -C ./$PACKAGE_DIR
        # move the tofu binary to /usr/local/bin
        echo "-- Moving tofu to /usr/local/bin"
        sudo cp ./$PACKAGE_DIR/tofu /usr/local/bin/opentofu
        echo "-- Adding /usr/local/bin to PATH"
        if ! grep -q "/usr/local/bin" ~/.zshrc; then
          echo 'export PATH="/usr/local/bin:$PATH"' >> ~/.zshrc
        fi
        # cleanup
        echo "-- Cleanup"
        rm -rf $PACKAGE $PACKAGE_DIR
    cmd_uninstall: |
      if (brew list --formula | grep -q opentofu); then
        brew uninstall opentofu
      else
        sudo rm -rf /usr/local/bin/opentofu
      fi